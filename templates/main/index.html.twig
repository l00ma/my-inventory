{% extends 'base.html.twig' %}

{% block title %}Overview
{% endblock %}

{% block body %}

	<div class="container-fluid">
		<div class="ms-2 text-secondary">
			<h3>Hello
				{{ app.user.name }},</h3>
		</div>
		<div class="row mt-2">
			<div class="col ms-2 text-secondary">
				{% if app.user.products.count %}
					{% if perime|length %}
						<h4>Here is the list of products whose date is expired:
						</h4>
						<span class="badge text-bg-primary">
							{% if perime|length == 1 %}
								{{ perime|length }}
								item
							{% elseif perime|length > 1 %}
								{{ perime|length }}
								items
							{% endif %}
						</span>
						<table class="table table-hover">
							<thead>
								<tr>
									<th>Name</th>
									<th>Brand</th>
									<th>Category</th>
									<th>Quantity</th>
									<th>Expiration date</th>
									<th>Expiration time</th>
									<th>Location</th>
									<th>actions</th>
								</tr>
							</thead>
							<tbody>
								{% for product in perime %}
									{% if product.peremptionalert is defined and product.peremptionalert is not null %}
										<tr {% if product.peremptionalert == '0' %} style="background-color: {{product.peremptioncss}}" {% endif %}>
											<td>{{product.name}}</td>
											<td>{{product.brand}}</td>
											<td>{{product.category.name}}</td>
											<td>{{product.quantity}}</td>
											<td>{{product.limitdate|date('d/m/Y')}}</td>
											<td>
												{% if product.peremptiontime < 0 %}
													expired
													{{ product.peremptiontime|abs }}
													days ago
												{% else %}
													{{ product.peremptiontime }}
													days left
												{% endif %}
											</td>
											<td>{{product.location}}</td>
											<td>
												<a href="{{ path('app_product_show', {'id': product.id}) }}" class="btn btn-primary btn-sm">show</a>
												<a href="{{ path('app_product_edit', {'id': product.id}) }}" class="btn btn-primary btn-sm">edit</a>
											</td>
										</tr>

									{% endif %}
								{% endfor %}
							</tbody>
						</table>
					{% else %}
						<h4>Congratulation: no expired product.
						</h4>
					{% endif %}
					{% if soon_perime|length %}
						<h4>Here is the list of products whose date will expire in next
							{{ app.user.peremptionwarning }}
							days:
						</h4>
						<span class="badge text-bg-primary">
							{% if soon_perime|length == 1 %}
								{{ soon_perime|length }}
								item
							{% elseif soon_perime|length > 1 %}
								{{ soon_perime|length }}
								items
							{% endif %}
						</span>
						<table class="table table-hover">
							<thead>
								<tr>
									<th>Name</th>
									<th>Brand</th>
									<th>Category</th>
									<th>Quantity</th>
									<th>Expiration date</th>
									<th>Expiration time</th>
									<th>Location</th>
									<th>actions</th>
								</tr>
							</thead>
							<tbody>
								{% for product in soon_perime %}
									{% if product.peremptionalert is defined and product.peremptionalert is not null %}
										<tr {% if product.peremptionalert == '1' %} style="background-color: {{product.peremptioncss}}" {% endif %}>
											<td>{{product.name}}</td>
											<td>{{product.brand}}</td>
											<td>{{product.category.name}}</td>
											<td>{{product.quantity}}</td>
											<td>{{product.limitdate|date('d/m/Y')}}</td>
											<td>{{ product.peremptiontime }}
												days left</td>
											<td>{{product.location}}</td>
											<td>
												<a href="{{ path('app_product_show', {'id': product.id}) }}" class="btn btn-primary btn-sm">show</a>
												<a href="{{ path('app_product_edit', {'id': product.id}) }}" class="btn btn-primary btn-sm">edit</a>
											</td>
										</tr>

									{% endif %}
								{% endfor %}
							</tbody>
						</table>
					{% endif %}
				{% else %}
					<p>Click on "Products list" to start adding products to your inventory.</p>
				{% endif %}
			</div>
		</div>
		<!-- HTML for charts-->
		{% if app.user.products.count %}
			<div class="row mt-2">
				<div class="col ms-2 text-secondary">
					<h4>Kg per categories chart:
					</h4>
					<div id="chartdiv"></div>
				</div>
			</div>
		{% endif %}
	</div>


	<!-- Styles -->
	<style>
		#chartdiv {
			width: 100%;
			height: 500px;
		}
	</style>

	<!-- Resources -->
	<script src="https://cdn.amcharts.com/lib/5/index.js"></script>
	<script src="https://cdn.amcharts.com/lib/5/percent.js"></script>
	<script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>

	<!-- Chart code -->
	<script>
		am5.ready(function () {

// Create root element
// https://www.amcharts.com/docs/v5/getting-started/#Root_element
var root = am5.Root.new("chartdiv");

// Set themes
// https://www.amcharts.com/docs/v5/concepts/themes/
root.setThemes([am5themes_Animated.new(root)]);

// Create chart
// https://www.amcharts.com/docs/v5/charts/percent-charts/pie-chart/
var chart = root.container.children.push(am5percent.PieChart.new(root, {endAngle: 270}));

// Create series
// https://www.amcharts.com/docs/v5/charts/percent-charts/pie-chart/#Series
var series = chart.series.push(am5percent.PieSeries.new(root, {
valueField: "value",
categoryField: "category",
endAngle: 270
}));

series.states.create("hidden", {endAngle: -90});

// Set data
// https://www.amcharts.com/docs/v5/charts/percent-charts/pie-chart/#Setting_data
series.data.setAll([{% for key,value in chart %}{
category: "{{ key }}",
value: {{ value }}
},{% endfor %}]);

series.appear(1000, 100);

}); // end am5.ready()
	</script>
{% endblock %}
